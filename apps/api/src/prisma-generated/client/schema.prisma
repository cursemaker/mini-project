generator client {
  provider = "prisma-client-js"
  output   = "../src/prisma-generated/client"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model CountryPhone {
  id                       Int                       @id @default(autoincrement())
  name                     String                    @unique
  code                     String                    @unique
  mobileCode               String
  createdAt                DateTime                  @default(now())
  updatedAt                DateTime                  @updatedAt
  deletedAt                DateTime?
  members                  Member[]
  creatorProfile           CreatorProfile[]
  events                   Event[]
  ticketTransactionDetails TicketTransactionDetail[]

  @@map("country_phone")
}

model Member {
  id                          String              @id @default(uuid())
  email                       String              @unique
  countryPhoneId              Int
  phoneNumber                 String              @unique
  firstName                   String
  lastName                    String?
  birthDate                   String
  createdAt                   DateTime            @default(now())
  updatedAt                   DateTime            @updatedAt
  deletedAt                   DateTime?
  eventPromoAccepted          Boolean             @default(true)
  personalDataConsentAccepted Boolean
  termsPrivacyAccepted        Boolean
  sex                         Sex
  isEmailVerified             Boolean             @default(false)
  countryPhone                CountryPhone        @relation(fields: [countryPhoneId], references: [id])
  verificationCodes           VerificationCode[]
  creatorProfile              CreatorProfile?
  ticketTransactions          TicketTransaction[]

  @@map("members")
}

enum Sex {
  MALE
  FEMALE
  OTHER
  PREFER_NOT_TO_SAY
}

model VerificationCode {
  id        String    @id @default(uuid())
  code      String
  email     String
  type      CodeType
  expiredAt DateTime
  isUsed    Boolean   @default(false)
  attempts  Int       @default(0)
  memberId  String?
  member    Member?   @relation(fields: [memberId], references: [id])
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime?

  @@index([email])
  @@index([code])
  @@map("verification_code")
}

enum CodeType {
  REGISTRATION
  LOGIN
}

model CreatorProfile {
  id                 String       @id @default(cuid())
  memberId           String       @unique
  member             Member       @relation(fields: [memberId], references: [id])
  bannerImgUrl       String?
  logoImgUrl         String?
  profileLinkUrl     String       @unique
  countryPhoneId     Int
  countryPhone       CountryPhone @relation(fields: [countryPhoneId], references: [id])
  creatorPhoneNumber String?
  address            String?
  aboutUsInfo        String?
  xUserName          String?
  igUserName         String?
  fbProfileUrl       String?
  createdAt          DateTime     @default(now())
  updatedAt          DateTime     @updatedAt
  deletedAt          DateTime?
  event              Event[]

  @@map("creator_profile")
}

model Event {
  id                      Int                 @id @default(autoincrement())
  creatorId               String
  creator                 CreatorProfile      @relation(fields: [creatorId], references: [id])
  eventName               String
  eventFormatId           Int
  eventFormat             EventFormat         @relation(fields: [eventFormatId], references: [id])
  eventTopicId            Int
  eventTopic              EventTopic          @relation(fields: [eventTopicId], references: [id])
  organizerName           String?
  organizerLogoImgUrl     String?
  eventDate               DateTime
  eventTime               DateTime
  eventLocation           String
  eventDesc               String?
  ticketType              TicketType
  ticketName              String
  ticketQty               Int
  ticketPrice             Int                 @default(20000)
  ticketDesc              String?
  ticketTermsAndCondition String
  ticketStartDate         DateTime
  ticketEndDate           DateTime
  eventCPName             String
  eventCPEmail            String
  eventCountryPhoneId     Int
  eventCountryPhone       CountryPhone        @relation(fields: [eventCountryPhoneId], references: [id])
  ticketDataFormType      TicketDataFormType
  maxTicketPerTransaction Int
  oneEmailOneTransaction  Boolean             @default(false)
  ticketDataFormUnique    Boolean             @default(false)
  isDraft                 Boolean?            @default(false)
  createdAt               DateTime            @default(now())
  updatedAt               DateTime            @updatedAt
  deletedAt               DateTime?
  ticketTransactions      TicketTransaction[]

  @@map("events")
}

enum TicketType {
  BERBAYAR
  BAYAR_SESUKAMU
  GRATIS
}

enum TicketDataFormType {
  NO_ID
  WITH_ID
}

model EventFormat {
  id         Int     @id @default(autoincrement())
  formatName String
  event      Event[]

  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime?

  @@map("event_formats")
}

model EventTopic {
  id        Int     @id @default(autoincrement())
  topicName String
  event     Event[]

  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime?

  @@map("event_topics")
}

model TicketTransaction {
  id                       Int                       @id @default(autoincrement())
  eventId                  Int
  event                    Event                     @relation(fields: [eventId], references: [id])
  memberId                 String
  member                   Member                    @relation(fields: [memberId], references: [id])
  ticketCode               String                    @unique
  ticketTransactionDetails TicketTransactionDetail[]

  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime?

  @@map("ticket_transactions")
}

model TicketTransactionDetail {
  id                  Int               @id @default(autoincrement())
  ticketTransactionId Int
  ticketTransactions  TicketTransaction @relation(fields: [ticketTransactionId], references: [id])
  orderName           String
  orderCountryPhoneId Int
  orderCountryPhone   CountryPhone      @relation(fields: [orderCountryPhoneId], references: [id])
  orderEmail          String
  orderBirthDate      String
  orderSex            Sex
  createdAt           DateTime          @default(now())
  updatedAt           DateTime          @updatedAt
  deletedAt           DateTime?

  @@map("ticket_transaction_details")
}
